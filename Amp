if not game:IsLoaded() then game.Loaded:Wait() end

local MT = getrawmetatable(game)
local OldIndex = MT. __index
local OldNamecall = MT.__namecall

setreadonly(MT, false)
MT.__index = newcclosure(function(P, M, TH, TI, HB, SZ)
	if not checkcaller() and getnamecallmethod() then
		if tostring(P) == "Position" and tostring(M) == "Magnitude" then return end
		if tostring(HB) == "HumanoidRootPart" and tostring(SZ) == "Size" then return end
		if tostring(TH) == "Handle" then return end
		if tostring(TI) == "firetouchinterest" then return end
	end
	return OldIndex(P, M, TH, TI, HB, SZ)
end)

for _, v in next, getconnections(game:GetService("LogService").MessageOut) do v:Disable() end
for _, v in next, getconnections(game:GetService("ScriptContext").Error) do v:Disable() end
game:GetService("ScriptContext"):SetTimeout(0.1)

setreadonly(MT, true) 


getgenv().Settings = {
	
	amp = {
		Toggle = true,
		ampX = 5,
		HitAll = true
	},

	lunge = {
		Toggle = false ,
		Range = 9  	
	},

	hitbox = {
		Toggle = true , 
		Size = 2, 
		Visual = false ,
		Color = Color3.fromRGB(0, 0, 0)	
	}
}

local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local player = Players.LocalPlayer

RunService.Heartbeat:Connect(function()
	if not Settings.amp.Toggle then return end
	
	local GetPlayers = Players:GetPlayers()
	for _, others in pairs(GetPlayers) do
		if others.Name ~= player.Name then

			local othersChar = others.Character
			local othersHumanoid = othersChar and othersChar:FindFirstChildOfClass("Humanoid")

			local Char = player.Character
			local Humanoid = Char and Char:FindFirstChildOfClass("Humanoid")

			if Humanoid and othersHumanoid then
				if Humanoid.Health > 0 and othersHumanoid.Health > 0 then

					local tool = Char and Char:FindFirstChildOfClass("Tool")
					local Handle = tool and tool:FindFirstChild("Handle")
					if not tool and Handle then return end 

					pcall(function()
						local HandleTouchInstances = Handle:GetTouchingParts() 
						for _, hit in pairs(HandleTouchInstances) do
							if hit:IsA("BasePart") then

								local TargetChar = hit.Parent
								if TargetChar == Char then return end 
								local TargetChildren = TargetChar:GetChildren()

								if Settings.amp.HitAll then 
									for _, Child in pairs(TargetChildren) do
										if Child:IsA("BasePart") then
											for _ = 1, Settings.amp.ampX do
												firetouchinterest(Child, Handle, 0)
												firetouchinterest(Child, Handle, 1)
											end
										end
									end
								else
									for _ = 1, Settings.amp.ampX do
										firetouchinterest(hit, Handle, 0)
										firetouchinterest(hit, Handle, 1)
									end
								end
							end
						end
					end)
				end
			end
		end
	end
end)

RunService.Stepped:Connect(function()
	if Settings.hitbox.Toggle then
		for _, p in pairs(Players:GetPlayers()) do
			if p.Name ~= player.Name then
				pcall(function()
					local qChar = p.Character
					local qHRP = qChar and qChar:FindFirstChild("HumanoidRootPart")
					qHRP.Size = Vector3.new(Settings.hitbox.Size, Settings.hitbox.Size, Settings.hitbox.Size)
					qHRP.CanCollide = false
				end)
			end
		end
	else
		for _, p in pairs(Players:GetPlayers()) do
			if p.Name ~= player.Name then
				pcall(function()
					local qChar = p.Character
					local qHRP = qChar and qChar:FindFirstChild("HumanoidRootPart")
					qHRP.Size = Vector3.new(2, 2, 1)
					qHRP.CanCollide = false
				end)
			end
		end
	end

	if Settings.hitbox.Visual then
		for _, p in pairs(Players:GetPlayers()) do
			if p.Name ~= player.Name then
				pcall(function()
					local qChar = p.Character
					local qHRP = qChar and qChar:FindFirstChild("HumanoidRootPart")
					qHRP.Transparency = 0.7
				end)
			end
		end
	else
		for _, p in pairs(Players:GetPlayers()) do
			if p.Name ~= player.Name then
				pcall(function()
					local qChar = p.Character
					local qHRP = qChar and qChar:FindFirstChild("HumanoidRootPart")
					qHRP.Transparency = 1
				end)
			end
		end
	end

	for _, p in pairs(Players:GetPlayers()) do
		if p.Name ~= player.Name then
			pcall(function()
				local qChar = p.Character
				local qHRP = qChar and qChar:FindFirstChild("HumanoidRootPart")

				qHRP.Color = Settings.hitbox.Color
			end)
		end
	end
	
	if Settings.lunge.Toggle then
		for _, p in pairs(Players:GetPlayers()) do
			if p.Name ~= player.Name then

				local pChar = p.Character
				local pHRP = pChar and pChar:FindFirstChild("HumanoidRootPart")
				local pHM = pChar and pChar:FindFirstChildOfClass("Humanoid")

				local Char = player.Character
				local HRP = Char and Char:FindFirstChild("HumanoidRootPart")
				local HM = Char and Char:FindFirstChildOfClass("Humanoid")

				if HM and pHM then
					if HM.Health > 0 and pHM.Health > 0 then
						local tool = Char and Char:FindFirstChildOfClass("Tool")
						local Handle = tool and tool:FindFirstChild("Handle")
						if not tool and Handle then return end
						
						local Distance = (Handle.Position - pHRP.Position).Magnitude
						if Distance <= Settings.lunge.Range then tool:Activate() end
					end
				end
			end
		end
	end
end)
